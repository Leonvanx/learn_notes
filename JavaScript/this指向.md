thisçš„5ç§ç»‘å®šæ–¹å¼ï¼š

- é»˜è®¤ç»‘å®š(éžä¸¥æ ¼æ¨¡å¼ä¸‹thisæŒ‡å‘å…¨å±€å¯¹è±¡,     ä¸¥æ ¼æ¨¡å¼ä¸‹thisä¼šç»‘å®šåˆ°undefined)
- éšå¼ç»‘å®š(å½“å‡½æ•°å¼•ç”¨æœ‰**ä¸Šä¸‹æ–‡å¯¹è±¡**æ—¶, å¦‚     obj.foo()çš„è°ƒç”¨æ–¹å¼, fooå†…çš„thisæŒ‡å‘obj)
- æ˜¾ç¤ºç»‘å®š(é€šè¿‡call()æˆ–è€…apply()æ–¹æ³•ç›´æŽ¥æŒ‡å®šthisçš„ç»‘å®šå¯¹è±¡,     å¦‚foo.call(obj))
- newç»‘å®š
- ç®­å¤´å‡½æ•°ç»‘å®š(thisçš„æŒ‡å‘ç”±å¤–å±‚ä½œç”¨åŸŸå†³å®šçš„)

**1. é»˜è®¤ç»‘å®š**

ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ï¼šåœ¨éžä¸¥æ ¼æ¨¡å¼ä¸‹thisæŒ‡å‘çš„æ˜¯å…¨å±€å¯¹è±¡windowï¼Œè€Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šç»‘å®šåˆ°undefinedã€‚

**1.1 é¢˜ç›®ä¸€**

```js
var a = 10;
function foo() {
 console.log(*this*.a)
}
foo();
```

æˆ‘ä»¬çŸ¥é“åœ¨ä½¿ç”¨varåˆ›å»ºå˜é‡çš„æ—¶å€™(ä¸åœ¨å‡½æ•°é‡Œ)ï¼Œä¼šæŠŠåˆ›å»ºçš„å˜é‡ç»‘å®šåˆ°windowä¸Šï¼Œæ‰€ä»¥æ­¤æ—¶aæ˜¯windowä¸‹çš„å±žæ€§ã€‚è€Œå‡½æ•°fooä¹Ÿæ˜¯windowä¸‹çš„å±žæ€§ã€‚å› æ­¤ä¸Šé¢çš„ä»£ç å…¶å®žå°±ç›¸å½“äºŽæ˜¯è¿™æ ·:

```js
window.a = 10;

function foo() {
 console.log(*this*.a)
}
window.foo();
```

åœ¨è¿™é‡Œï¼Œè°ƒç”¨ `foo()` å‡½æ•°çš„æ˜¯ `window` å¯¹è±¡ï¼Œä¸”åˆæ˜¯åœ¨éžä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæ‰€ä»¥ `foo()` ä¸­ `this` çš„æŒ‡å‘æ˜¯ `window` å¯¹è±¡ï¼Œå› æ­¤ `this.a`ä¼šè¾“å‡º10ã€‚

**1.2 é¢˜ç›®äºŒ**

```js
"use strict";
var a = 10;
function foo() {
 console.log('this1', *this*)
 console.log(window.a)
 console.log(*this*.a)
}
console.log(window.foo)
console.log('this2', *this*)
foo();
```

éœ€è¦æ³¨æ„çš„ç‚¹ï¼š

- å¼€å¯äº†ä¸¥æ ¼æ¨¡å¼ï¼Œåªæ˜¯è¯´ä½¿å¾—å‡½æ•°å†…çš„thisæŒ‡å‘undefinedï¼Œå®ƒå¹¶ä¸ä¼šæ”¹å˜å…¨å±€ä¸­thisçš„æŒ‡å‘ã€‚å› æ­¤this1ä¸­æ‰“å°çš„æ˜¯undefinedï¼Œè€Œthis2è¿˜æ˜¯windowå¯¹è±¡ã€‚
- å¦å¤–ï¼Œå®ƒä¹Ÿä¸ä¼šé˜»æ­¢aè¢«ç»‘å®šåˆ°windowå¯¹è±¡ä¸Šã€‚

æ‰€ä»¥æœ€åŽçš„æ‰§è¡Œç»“æžœï¼š

f foo() {... }

'this2' Window{... }

'this1' undefined

10

Uncaught TypeError: Cannot read property 'a' of undefined

**1.3 é¢˜ç›®ä¸‰**

*let* a = 10

*const* b = 20

*function* foo() {

 console.log(*this*.a)

 console.log(*this*.b)

}

foo();

console.log(window.a)

 

å¦‚æžœæŠŠvaræ”¹æˆäº†let æˆ–è€… constï¼Œå˜é‡æ˜¯ä¸ä¼šè¢«ç»‘å®šåˆ°windowä¸Šçš„ï¼Œæ‰€ä»¥æ­¤æ—¶ä¼šæ‰“å°å‡ºä¸‰ä¸ªundefinedã€‚

ç­”æ¡ˆï¼š

 

undefined

undefined

undefined

**1.4 é¢˜ç›®å››**

*var* a = 1

*function* foo() {

 *var* a = 2

 console.log(*this*)

 console.log(*this*.a)

}

foo()

è¿™é‡Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±çŸ¥é“ï¼Œfoo()å‡½æ•°å†…çš„thisæŒ‡å‘çš„æ˜¯windowï¼Œå› ä¸ºæ˜¯windowè°ƒç”¨çš„fooã€‚ä½†æ˜¯æ‰“å°å‡ºçš„this.aå‘¢ï¼Ÿæ³¨æ„ï¼Œæ˜¯this.aï¼Œä¸æ˜¯aï¼Œå› æ­¤æ˜¯windowä¸‹çš„aã€‚

å¹¶ä¸”ç”±äºŽå‡½æ•°ä½œç”¨åŸŸçš„åŽŸå› æˆ‘ä»¬çŸ¥é“windowä¸‹çš„aè¿˜æ˜¯1ã€‚å› æ­¤ç­”æ¡ˆä¸ºï¼š

Window{...}

1

**1.5 é¢˜ç›®äº”**

*var* a = 1

*function* foo() {

 *var* a = 2

 *function* inner() {

  console.log(*this*.a)

 }

 inner()

}

foo()

å…¶å®žè¿™é‡Œå’Œ1.4å¾ˆåƒï¼Œä¸è¿‡ä¸€çœ‹åˆ°å‡½æ•°å†…çš„å‡½æ•°ï¼Œå°±å¾ˆå®¹æ˜“è®©äººè”æƒ³åˆ°é—­åŒ… ðŸ˜‚ï¼Œç„¶åŽ... ç„¶åŽå°±è„±å£è€Œå‡ºï¼Œç­”æ¡ˆæ˜¯2å•Šï¼Œè¿™è¿˜ä¸ç®€å•ã€‚å°ä¼™ä¼´ä»¬ï¼Œå®¡é¢˜å¯å¾—ä»”ç»†å•Šï¼Œè¿™é‡Œé—®ä½ çš„æ˜¯this.aï¼Œè€Œåœ¨innerä¸­ï¼ŒthisæŒ‡å‘çš„è¿˜æ˜¯windowã€‚

ç­”æ¡ˆï¼š1

**2. éšå¼ç»‘å®š**

**this æ°¸è¿œæŒ‡å‘æœ€åŽè°ƒç”¨å®ƒçš„é‚£ä¸ªå¯¹è±¡**ã€‚è°æœ€åŽè°ƒç”¨çš„å‡½æ•°ï¼Œå‡½æ•°å†…çš„thisæŒ‡å‘çš„å°±æ˜¯è°(ä¸è€ƒè™‘ç®­å¤´å‡½æ•°)

**2.1 é¢˜ç›®ä¸€**

*function* foo() {

 *console*.log(this.a)

}

*var* obj = { a: 1, foo }

*var* a = 2

obj.foo()

 

(var obj = { foo }å°±ç›¸å½“äºŽæ˜¯var obj = { foo: foo }ï¼Œè¿™ä¸ªå¤§å®¶åº”è¯¥éƒ½çŸ¥é“å§)

åœ¨è¿™é“é¢˜ä¸­ï¼Œå‡½æ•°foo()è™½ç„¶æ˜¯å®šä¹‰åœ¨windowä¸‹ï¼Œä½†æ˜¯æˆ‘åœ¨objå¯¹è±¡ä¸­å¼•ç”¨äº†å®ƒï¼Œå¹¶å°†å®ƒé‡æ–°èµ‹å€¼åˆ°obj.fooä¸Šã€‚ä¸”è°ƒç”¨å®ƒçš„æ˜¯objå¯¹è±¡ï¼Œå› æ­¤æ‰“å°å‡ºæ¥çš„this.aåº”è¯¥æ˜¯objä¸­çš„aã€‚æ¢ä¸ªè§’åº¦æƒ³ï¼Œä¸Šé¢ðŸ‘†è¿™æ®µä»£ç æ˜¯ä¸æ˜¯å°±ç›¸å½“äºŽæ˜¯è¿™æ ·ï¼š

*var* obj = {

 a: 1,

 foo: *function* () {

  *console*.log(this.a)

 }

}

*var* a = 2

obj.foo()

ç­”æ¡ˆéƒ½æ˜¯ï¼š

**3. éšå¼ç»‘å®šçš„éšå¼ä¸¢å¤±é—®é¢˜**

éšå¼ä¸¢å¤±å…¶å®žå°±æ˜¯è¢«éšå¼ç»‘å®šçš„å‡½æ•°åœ¨ç‰¹å®šçš„æƒ…å†µä¸‹ä¼šä¸¢å¤±ç»‘å®šå¯¹è±¡ã€‚

æœ‰ä¸¤ç§æƒ…å†µå®¹æ˜“å‘ç”Ÿéšå¼ä¸¢å¤±é—®é¢˜ï¼š

- ä½¿ç”¨å¦ä¸€ä¸ªå˜é‡æ¥ç»™å‡½æ•°å–åˆ«å
- å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’æ—¶ä¼šè¢«éšå¼èµ‹å€¼ï¼Œå›žè°ƒå‡½æ•°ä¸¢å¤±thisç»‘å®š

 

**3.1 é¢˜ç›®ä¸€**

ä½¿ç”¨å¦ä¸€ä¸ªå˜é‡æ¥ç»™å‡½æ•°å–åˆ«åä¼šå‘ç”Ÿéšå¼ä¸¢å¤±ã€‚

 

*function* foo() {

 *console*.log(this.a)

};

*var* obj = { a: 1, foo };

*var* a = 2;

*var* foo2 = obj.foo;

obj.foo();

foo2();

 

åœ¨è¿™é‡Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼Œobj.foo()ä¸­thisçš„æŒ‡å‘æ˜¯ä¸ºobjçš„(å¯ä»¥çœ‹ç¬¬äºŒéƒ¨åˆ†éšå¼ç»‘å®š)ï¼Œæ‰€ä»¥obj.foo()æ‰§è¡Œçš„æ—¶å€™ï¼Œæ‰“å°å‡ºæ¥çš„æ˜¯objå¯¹è±¡ä¸­çš„aï¼Œä¹Ÿå°±æ˜¯1ã€‚

ä½†æ˜¯foo2å®ƒä¸ä¹Ÿæ˜¯obj.fooå—ï¼Ÿæˆ‘åªä¸è¿‡æ˜¯ç”¨äº†ä¸€ä¸ªå˜é‡foo2æ¥ç››æ”¾äº†å®ƒè€Œå·²ã€‚æ‰€ä»¥ä½ æ˜¯ä¸æ˜¯è®¤ä¸ºå®ƒæ‰“å°çš„ä¹Ÿæ˜¯1å‘¢ï¼Ÿ

é¢ ðŸ˜…ï¼Œå…¶å®žè¿™é‡Œä¸æ˜¯çš„ï¼Œå®ƒæ‰“å°å‡ºçš„æ˜¯windowä¸‹çš„aã€‚è¿™æ˜¯å› ä¸ºè™½ç„¶foo2æŒ‡å‘çš„æ˜¯obj.fooå‡½æ•°ï¼Œä¸è¿‡è°ƒç”¨å®ƒçš„å´æ˜¯windowå¯¹è±¡ï¼Œæ‰€ä»¥å®ƒé‡Œé¢thisçš„æŒ‡å‘æ˜¯ä¸ºwindowã€‚

ç­”æ¡ˆï¼š1 2

**3.2 é¢˜ç›®äºŒ**

*function* foo() {

 *console*.log(this.a)

};

*var* obj = { a: 1, foo };

*var* a = 2;

*var* foo2 = obj.foo;

*var* obj2 = { a: 3, foo2: obj.foo }

obj.foo();

foo2();

obj2.foo2();

 

ç­”æ¡ˆï¼š1 2 3

- obj.foo()ä¸­çš„thisæŒ‡å‘è°ƒç”¨è€…obj
- foo2()å‘ç”Ÿäº†éšå¼ä¸¢å¤±ï¼Œè°ƒç”¨è€…æ˜¯windowï¼Œä½¿å¾—foo()ä¸­çš„thisæŒ‡å‘window
- foo3()å‘ç”Ÿäº†éšå¼ä¸¢å¤±ï¼Œè°ƒç”¨è€…æ˜¯obj2ï¼Œä½¿å¾—foo()ä¸­çš„thisæŒ‡å‘obj2

**3.3 é¢˜ç›®ä¸‰**

å¦‚æžœä½ æŠŠä¸€ä¸ªå‡½æ•°å½“æˆå‚æ•°ä¼ é€’æ—¶ï¼Œä¹Ÿä¼šè¢«éšå¼èµ‹å€¼ï¼Œå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚

 

*function* foo() {

 *console*.log(this.a)

}

*function* doFoo(*fn*) {

 *console*.log(this)

 fn()

}

*var* obj = { a: 1, foo }

*var* a = 2

doFoo(obj.foo)

è¿™é‡Œæˆ‘ä»¬å°†obj.fooå½“æˆå‚æ•°ä¼ é€’åˆ°doFooå‡½æ•°ä¸­ï¼Œåœ¨ä¼ é€’çš„è¿‡ç¨‹ä¸­ï¼Œobj.foo()å‡½æ•°å†…çš„thiså‘ç”Ÿäº†æ”¹å˜ï¼ŒæŒ‡å‘äº†windowã€‚

å› æ­¤ç»“æžœä¸ºï¼šWindow{...}   2

**3.4 é¢˜ç›®å››**

çŽ°åœ¨æˆ‘ä»¬ä¸ç”¨windowè°ƒç”¨doFooï¼Œè€Œæ˜¯æ”¾åœ¨å¯¹è±¡obj2é‡Œï¼Œç”¨obj2è°ƒç”¨ï¼š

 

*function* foo() {

 *console*.log(this.a)

}

*function* doFoo(*fn*) {

 *console*.log(this)

 fn()

}

*var* obj = { a: 1, foo }

*var* a = 2

*var* obj2 = { a: 3, doFoo }

obj2.doFoo(obj.foo)

 

çŽ°åœ¨è°ƒç”¨obj2.doFoo()å‡½æ•°ï¼Œé‡Œé¢çš„thisæŒ‡å‘çš„åº”è¯¥æ˜¯obj2ï¼Œå› ä¸ºæ˜¯obj2è°ƒç”¨çš„å®ƒã€‚ä½†æ˜¯obj.foo()æ‰“å°å‡ºæ¥çš„aä¾ç„¶æ˜¯2ï¼Œä¹Ÿå°±æ˜¯windowä¸‹çš„ã€‚

æ‰§è¡Œç»“æžœä¸ºï¼š{ a:3, **do**Foo: f }   2

**æ‰€ä»¥è¯´ï¼Œå¦‚æžœä½ æŠŠä¸€ä¸ªå‡½æ•°å½“æˆå‚æ•°ä¼ é€’åˆ°å¦ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä¹Ÿä¼šå‘ç”Ÿéšå¼ä¸¢å¤±çš„é—®é¢˜ï¼Œä¸”ä¸ŽåŒ…è£¹ç€å®ƒçš„å‡½æ•°çš„thisæŒ‡å‘æ— å…³ã€‚åœ¨éžä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä¼šæŠŠè¯¥å‡½æ•°çš„thisç»‘å®šåˆ°windowä¸Šï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹ç»‘å®šåˆ°undefinedã€‚**

**4. æ˜¾å¼ç»‘å®š**

åŠŸèƒ½å¦‚å…¶åï¼Œå°±æ˜¯å¼ºè¡Œä½¿ç”¨æŸäº›æ–¹æ³•ï¼Œæ”¹å˜å‡½æ•°å†…thisçš„æŒ‡å‘ã€‚

é€šè¿‡call()ã€apply()æˆ–è€…bind()æ–¹æ³•ç›´æŽ¥æŒ‡å®šthisçš„ç»‘å®šå¯¹è±¡, å¦‚foo.call(obj)ã€‚

è¿™é‡Œæœ‰å‡ ä¸ªçŸ¥è¯†ç‚¹éœ€è¦æ³¨æ„ï¼š

- ä½¿ç”¨.call()æˆ–è€….apply()çš„å‡½æ•°æ˜¯ä¼šç›´æŽ¥æ‰§è¡Œçš„

- bind()æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨æ‰ä¼šæ‰§è¡Œ
- .call()å’Œ.apply()ç”¨æ³•åŸºæœ¬ç±»ä¼¼ï¼Œä¸è¿‡callæŽ¥æ”¶è‹¥å¹²ä¸ªå‚æ•°ï¼Œè€ŒapplyæŽ¥æ”¶çš„æ˜¯ä¸€ä¸ªæ•°ç»„

**4.1 é¢˜ç›®ä¸€**

*function* foo () {

 *console*.log(this.a)

}

*var* obj = { a: 1 }

*var* a = 2

foo()

foo.call(obj)

foo.apply(obj)

foo.bind(obj)

ç­”æ¡ˆï¼š

**4.2 é¢˜ç›®äºŒ**

*var* obj1 = {

 a: 1

}

*var* obj2 = {

 a: 2,

 foo1: *function* () {

  *console*.log(this.a)

 },

 foo2: *function* () {

  setTimeout(*function* () {

   *console*.log(this)

   *console*.log(this.a)

  }, 0)

 }

}

*var* a = 3

obj2.foo1()

obj2.foo2()

 

å¯¹äºŽsetTimeoutä¸­çš„å‡½æ•°ï¼Œè¿™é‡Œå­˜åœ¨éšå¼ç»‘å®šçš„éšå¼ä¸¢å¤±ï¼Œä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’æ—¶ä¼šè¢«éšå¼èµ‹å€¼ï¼Œå›žè°ƒå‡½æ•°ä¸¢å¤±thisç»‘å®šï¼Œå› æ­¤è¿™æ—¶å€™setTimeoutä¸­çš„å‡½æ•°å†…çš„thisæ˜¯æŒ‡å‘windowçš„

 

æ‰€ä»¥æœ€ç»ˆçš„ç»“æžœæ˜¯ï¼š

 

2

Window{...}

3

**4.3 é¢˜ç›®ä¸‰**

é¢å¯¹ä¸Šé¢ðŸ‘†è¿™ç§æƒ…å†µæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨callã€apply æˆ–è€…bindæ¥æ”¹å˜å‡½æ•°ä¸­thisçš„æŒ‡å‘ï¼Œä½¿å®ƒç»‘å®šåˆ°obj1ä¸Šï¼Œä»Žè€Œæ‰“å°å‡º1ã€‚

*var* obj1 = {

 a: 1

}

*var* obj2 = {

 a: 2,

 foo1: *function* () {

  *console*.log(this.a)

 },

 foo2: *function* () {

  setTimeout(*function* () {

   *console*.log(this)

   *console*.log(this.a)

  }.call(obj1), 0)

 }

}

*var* a = 3

obj2.foo1()

obj2.foo2()

 

çŽ°åœ¨çš„æ‰§è¡Œç»“æžœå°±æ˜¯ï¼š

2

{ a: 1 }

1

è¿™é‡Œçš„å†™æ³•æ˜¯å°†.callè¿ç”¨åˆ°setTimeouté‡Œçš„å›žè°ƒå‡½æ•°ä¸Šï¼Œå¹¶ä¸æ˜¯è¿ç”¨åˆ°obj2.foo2()ä¸Šã€‚

 

æ‰€ä»¥ä¸‹é¢çš„è¿™ç§å†™æ³•ä¸å¯ä»¥å—ï¼Ÿ

 

obj2.foo2.call(obj1)

**æ³¨æ„âš ï¸**ï¼šå¦‚æžœæ˜¯è¿™ç§å†™æ³•çš„è¯ï¼Œæ”¹å˜çš„å°±æ˜¯foo2å‡½æ•°å†…çš„thisçš„æŒ‡å‘äº†ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œfoo2å‡½æ•°å†…thisçš„æŒ‡å‘å’ŒsetTimeouté‡Œå‡½æ•°çš„thisæ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œå› ä¸ºè°ƒç”¨å®šæ—¶å™¨çš„å§‹ç»ˆæ˜¯windowã€‚

**4.4 é¢˜ç›®å››**

*var* obj1 = {

 a: 1

}

*var* obj2 = {

 a: 2,

 foo1: *function* () {

  *console*.log(this.a)

 },

 foo2: *function* () {

  *function* inner () {

   *console*.log(this)

   *console*.log(this.a)

  }

  inner()

 }

}

*var* a = 3

obj2.foo1()

obj2.foo2()

è°ƒç”¨innerå‡½æ•°çš„ä¾ç„¶æ˜¯windowï¼Œæ‰€ä»¥ç»“æžœä¸ºï¼š

2

Window{...}

3

 

å¦‚æžœç»™inner()å‡½æ•°æ˜¾å¼ç»‘å®šçš„è¯ï¼š

ç»“æžœä¸º

2

{ a: 1 }

1

**4.5 é¢˜ç›®äº”**

*function* foo () {

 *console*.log(this.a)

}

*var* obj = { a: 1 }

*var* a = 2

foo()

foo.call(obj)

foo().call(obj)

 

ç»“æžœï¼š

2

1

2

Uncaught TypeError: Cannot read property 'call' of undefined

- foo().call(obj)å¼€å§‹ä¼šæ‰§è¡Œfoo()å‡½æ•°ï¼Œæ‰“å°å‡º2ï¼Œä½†æ˜¯ä¼šå¯¹foo()å‡½æ•°çš„è¿”å›žå€¼æ‰§è¡Œ.call(obj)æ“ä½œï¼Œå¯æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°foo()å‡½æ•°çš„è¿”å›žå€¼æ˜¯undefinedï¼Œå› æ­¤å°±ä¼šæŠ¥é”™äº†ã€‚

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°foo.call()å’Œfoo().call()çš„åŒºåˆ«äº†ï¼Œä¸€ä¸ªæ˜¯é’ˆå¯¹äºŽå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯é’ˆå¯¹äºŽå‡½æ•°çš„è¿”å›žå€¼ã€‚

**4.6 é¢˜ç›®å…­**

OKðŸ‘Œï¼Œæ—¢ç„¶åˆšåˆš4.5æ˜¯å› ä¸ºå‡½æ•°æ²¡æœ‰è¿”å›žå€¼æ‰æŠ¥çš„é”™ï¼Œé‚£æˆ‘çŽ°åœ¨ç»™å®ƒåŠ ä¸Šè¿”å›žå€¼çœ‹çœ‹ï¼š

*function* foo () {

 *console*.log(this.a)

 return *function* () {

  *console*.log(this.a)

 }

}

*var* obj = { a: 1 }

*var* a = 2

foo()

foo.call(obj)

foo().call(obj)

ç»“æžœç«Ÿç„¶æ˜¯ï¼š

2

1

2

1

- ç¬¬ä¸€ä¸ªæ•°å­—2è‡ªç„¶æ˜¯foo()è¾“å‡ºçš„ï¼Œè™½ç„¶foo()å‡½æ•°ä¹Ÿè¿”å›žäº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è°ƒç”¨å®ƒå‘€ï¼Œåªæœ‰å†™æˆfoo()()ï¼Œè¿™æ ·æ‰ç®—æ˜¯è°ƒç”¨åŒ¿åå‡½æ•°ã€‚
- ç¬¬äºŒä¸ªæ•°å­—1æ˜¯foo.call(obj)è¾“å‡ºçš„ï¼Œç”±äºŽ.call()æ˜¯ç´§è·Ÿç€fooçš„ï¼Œæ‰€ä»¥æ”¹å˜çš„æ˜¯foo()å†…thisçš„æŒ‡å‘ï¼Œå¹¶ä¸”.call()æ˜¯ä¼šä½¿å‡½æ•°ç«‹å³æ‰§è¡Œçš„ï¼Œå› æ­¤æ‰“å°å‡º1ï¼ŒåŒç†ï¼Œå®ƒä¹Ÿæ²¡æœ‰è°ƒç”¨è¿”å›žçš„å‡½æ•°ã€‚
- ç¬¬ä¸‰ä¸ªæ•°å­—2æ˜¯foo().call(obj)å…ˆæ‰§è¡Œfoo()æ—¶æ‰“å°å‡ºæ¥çš„ï¼Œæ­¤æ—¶foo()å†…thisè¿˜æ˜¯æŒ‡å‘windowã€‚
- åœ¨æ‰§è¡Œå®Œfoo()ä¹‹åŽï¼Œä¼šè¿”å›žä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå¹¶ä¸”åŽé¢ä½¿ç”¨äº†.call(obj)æ¥æ”¹å˜è¿™ä¸ªåŒ¿åå‡½æ•°çš„thisæŒ‡å‘å¹¶è°ƒç”¨äº†å®ƒï¼Œæ‰€ä»¥è¾“å‡ºäº†1ã€‚

**4.7 é¢˜ç›®ä¸ƒ**

å…ˆæ¥å›žå¿†ä¸€ä¸‹å®ƒä»¬çš„åŒºåˆ«ï¼šcallæ˜¯ä¼šç›´æŽ¥æ‰§è¡Œå‡½æ•°çš„ï¼Œbindæ˜¯è¿”å›žä¸€ä¸ªæ–°å‡½æ•°ï¼Œä½†ä¸ä¼šæ‰§è¡Œã€‚

 

*function* foo () {

 *console*.log(this.a)

 return *function* () {

  *console*.log(this.a)

 }

}

*var* obj = { a: 1 }

*var* a = 2

foo()

foo.bind(obj)

foo().bind(obj)

 

ç»“æžœè‡ªç„¶å°±æ˜¯ï¼š

2

2

**æ€»ç»“**

æ€»ç»“ä¸€ä¸‹è¿™éƒ¨åˆ†çš„çŸ¥è¯†ç‚¹å¥½äº†ï¼š

- this æ°¸è¿œæŒ‡å‘æœ€åŽè°ƒç”¨å®ƒçš„

- åŒ¿åå‡½æ•°çš„thisæ°¸è¿œæŒ‡å‘window
- ä½¿ç”¨.call()æˆ–è€….apply()çš„å‡½æ•°æ˜¯ä¼šç›´æŽ¥æ‰§è¡Œçš„

- bind()æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨æ‰ä¼šæ‰§è¡Œ

- å¦‚æžœcallã€applyã€bindæŽ¥æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç©ºæˆ–è€…nullã€undefinedçš„è¯ï¼Œåˆ™ä¼šå¿½ç•¥è¿™ä¸ªå‚æ•°

- forEachã€mapã€filterå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿæ˜¯èƒ½æ˜¾å¼ç»‘å®šthisçš„

**5****. ç®­å¤´å‡½æ•°ç»‘å®š**

 ç®­å¤´å‡½æ•°ï¼Œå®ƒé‡Œé¢çš„ `this` æ˜¯ç”±å¤–å±‚ä½œç”¨åŸŸæ¥å†³å®šçš„ï¼Œä¸”æŒ‡å‘å‡½æ•°å®šä¹‰æ—¶çš„ `this` è€Œéžæ‰§è¡Œæ—¶ã€‚

 ç®­å¤´å‡½æ•°ä¸­æ²¡æœ‰* *this* *ç»‘å®šï¼Œå¿…é¡»é€šè¿‡æŸ¥æ‰¾ä½œç”¨åŸŸé“¾æ¥å†³å®šå…¶å€¼ï¼Œå¦‚æžœç®­å¤´å‡½æ•°è¢«éžç®­å¤´å‡½æ•°åŒ…å«ï¼Œåˆ™* *this* *ç»‘å®šçš„æ˜¯æœ€è¿‘ä¸€å±‚éžç®­å¤´å‡½æ•°çš„* *this**ï¼Œå¦åˆ™ï¼Œ**this* *ä¸º* *undefined**ã€‚*

**5****.1 é¢˜ç›®ä¸€**

*var* obj = {

 name: 'obj',

 foo1: () *=>* {

  *console*.log(this.name)

 },

 foo2: *function* () {

  *console*.log(this.name)

  return () *=>* {

   *console*.log(this.name)

  }

 }

}

*var* name = 'window'

obj.foo1()

obj.foo2()()

 

- å¯¹äºŽobj.foo1()å‡½æ•°çš„è°ƒç”¨ï¼Œå®ƒçš„å¤–å±‚ä½œç”¨åŸŸæ˜¯windowï¼Œå¯¹è±¡objå½“ç„¶ä¸å±žäºŽä½œç”¨åŸŸäº†(æˆ‘ä»¬çŸ¥é“ä½œç”¨åŸŸåªæœ‰å…¨å±€ä½œç”¨åŸŸwindowå’Œå±€éƒ¨ä½œç”¨åŸŸå‡½æ•°)ã€‚æ‰€ä»¥ä¼šæ‰“å°å‡ºwindow

obj.foo2()()ï¼Œé¦–å…ˆä¼šæ‰§è¡Œobj.foo2()ï¼Œè¿™ä¸æ˜¯ä¸ªç®­å¤´å‡½æ•°ï¼Œæ‰€ä»¥å®ƒé‡Œé¢çš„thisæ˜¯è°ƒç”¨å®ƒçš„objå¯¹è±¡ï¼Œå› æ­¤æ‰“å°å‡ºobjï¼Œè€Œè¿”å›žçš„åŒ¿åå‡½æ•°æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œ**å®ƒçš„****this****ç”±å¤–å±‚ä½œç”¨åŸŸå†³å®š****ï¼Œ**é‚£ä¹Ÿå°±æ˜¯å‡½æ•°foo2å’¯ï¼Œé‚£ä¹Ÿå°±æ˜¯å®ƒçš„thisä¼šå’Œfoo2å‡½æ•°é‡Œçš„thisä¸€æ ·ï¼Œå°±ä¹Ÿæ‰“å°å‡ºäº†objã€‚

ç­”æ¡ˆï¼š

'window'

'obj'

'obj'

**5****.****2** **é¢˜ç›®****äºŒ**

*var* name = 'window'

*function* Person (*name*) {

 this.name = name

 this.foo1 = *function* () {

  *console*.log(this.name)

 }

 this.foo2 = () *=>* {

  *console*.log(this.name)

 }

}

*var* person2 = {

 name: 'person2',

 foo2: () *=>* {

  *console*.log(this.name)

 }

}

*var* person1 = new Person('person1')

person1.foo1()

person1.foo2()

person2.foo2()

è§£é¢˜æ€è·¯ï¼š

 

- person1.foo1()æ˜¯ä¸ªæ™®é€šå‡½æ•°ï¼Œ**thisç”±æœ€åŽè°ƒç”¨å®ƒçš„å¯¹è±¡å†³å®š**ï¼Œå³person1ã€‚

 

- person1.foo2()ä¸ºç®­å¤´å‡½æ•°ï¼Œ**thisç”±å¤–å±‚ä½œç”¨åŸŸå†³å®šï¼Œä¸”æŒ‡å‘å‡½æ•°å®šä¹‰æ—¶çš„thisè€Œéžæ‰§è¡Œæ—¶**ï¼Œåœ¨è¿™é‡Œå®ƒçš„å¤–å±‚ä½œç”¨åŸŸæ˜¯å‡½æ•°Personï¼Œä¸”è¿™ä¸ªæ˜¯æž„é€ å‡½æ•°ï¼Œå¹¶ä¸”ä½¿ç”¨äº†newæ¥ç”Ÿæˆäº†å¯¹è±¡person1ï¼Œæ‰€ä»¥æ­¤æ—¶thisçš„æŒ‡å‘æ˜¯ä¸ºperson1ã€‚

 

- person2.foo2()å­—é¢é‡åˆ›å»ºçš„çš„å¯¹è±¡person2ä¸­çš„foo2æ˜¯ä¸ªç®­å¤´å‡½æ•°ï¼Œç”±äºŽperson2æ˜¯ç›´æŽ¥åœ¨windowä¸‹åˆ›å»ºçš„ï¼Œä½ å¯ä»¥ç†è§£ä¸ºå®ƒæ‰€åœ¨çš„ä½œç”¨åŸŸå°±æ˜¯åœ¨windowä¸‹ï¼Œå› æ­¤person2.foo2()å†…çš„thisåº”è¯¥æ˜¯windowã€‚

 

ç­”æ¡ˆï¼š

'person1'

'person1'

'window'

**7.3 é¢˜ç›®ä¸‰**

*var* obj3 = {

 name: 'obj3',

 foo: () *=>* {

  *console*.log(this.name)

  return *function* () {

   *console*.log(this.name)

  }

 }

}

*var* obj4 = {

 name: 'obj4',

 foo: () *=>* {

  *console*.log(this.name)

  return () *=>* {

   *console*.log(this.name)

  }

 }

}

obj1.foo()()

obj2.foo()()

obj3.foo()()

obj4.foo()()

 

ç­”æ¡ˆï¼š

obj1.foo()() // 'obj1' 'window'

obj2.foo()() // 'obj2' 'obj2'

obj3.foo()() // 'window' 'window'

obj4.foo()() // 'window' 'window'

**æ€»ç»“**

OKðŸ‘Œï¼Œæ¥æ€»ç»“ä¸€ä¸‹ç®­å¤´å‡½æ•°éœ€è¦æ³¨æ„çš„ç‚¹å§ï¼š

- å®ƒé‡Œé¢çš„thisæ˜¯ç”±å¤–å±‚ä½œç”¨åŸŸæ¥å†³å®šçš„ï¼Œä¸”æŒ‡å‘å‡½æ•°å®šä¹‰æ—¶çš„thisè€Œéžæ‰§è¡Œæ—¶
- å­—é¢é‡åˆ›å»ºçš„å¯¹è±¡ï¼Œä½œç”¨åŸŸæ˜¯windowï¼Œå¦‚æžœé‡Œé¢æœ‰ç®­å¤´å‡½æ•°å±žæ€§çš„è¯ï¼ŒthisæŒ‡å‘çš„æ˜¯window
- æž„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡ï¼Œä½œç”¨åŸŸæ˜¯å¯ä»¥ç†è§£ä¸ºæ˜¯è¿™ä¸ªæž„é€ å‡½æ•°ï¼Œä¸”è¿™ä¸ªæž„é€ å‡½æ•°çš„thisæ˜¯æŒ‡å‘æ–°å»ºçš„å¯¹è±¡çš„ï¼Œå› æ­¤thisæŒ‡å‘è¿™ä¸ªå¯¹è±¡ã€‚
- ç®­å¤´å‡½æ•°çš„thisæ˜¯æ— æ³•é€šè¿‡bindã€callã€applyæ¥**ç›´æŽ¥**ä¿®æ”¹ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ”¹å˜ä½œç”¨åŸŸä¸­thisçš„æŒ‡å‘æ¥é—´æŽ¥ä¿®æ”¹ã€‚

**ä¼˜ç‚¹**

- ç®­å¤´å‡½æ•°å†™ä»£ç æ‹¥æœ‰æ›´åŠ ç®€æ´çš„è¯­æ³•(å½“ç„¶ä¹Ÿæœ‰äººè®¤ä¸ºè¿™æ˜¯ç¼ºç‚¹)

- thisç”±å¤–å±‚ä½œç”¨åŸŸå†³å®šï¼Œæ‰€ä»¥åœ¨æŸäº›åœºåˆæˆ‘ä»¬ä¸éœ€è¦å†™ç±»ä¼¼const that = thisè¿™æ ·çš„ä»£ç 

 

**é¿å…ä½¿ç”¨çš„åœºæ™¯**

 

1. ä½¿ç”¨ç®­å¤´å‡½æ•°å®šä¹‰å¯¹è±¡çš„æ–¹æ³•

 

*let* obj = {

 value: 'LinDaiDai',

 getValue: () *=>* *console*.log(this.value)

}

obj.getValue() // undefined

1. å®šä¹‰åŽŸåž‹æ–¹æ³•

*function* Foo (*value*) {

 this.value = value

}

*Foo*.prototype.getValue = () *=>* *console*.log(this.value)

*const* foo1 = new Foo(1)

foo1.getValue() // undefined

1. æž„é€ å‡½æ•°ä½¿ç”¨ç®­å¤´å‡½æ•°

*const* Foo = (*value*) *=>* {

 this.value = value;

}

*const* foo1 = new Foo(1)

// äº‹å®žä¸Šç›´æŽ¥å°±æŠ¥é”™äº† Uncaught TypeError: Foo is not a constructor

*console*.log(foo1);

1. ä½œä¸ºäº‹ä»¶çš„å›žè°ƒå‡½æ•°

*const* button = document.getElementById('myButton');

button.addEventListener('click', () *=>* {

  *console*.log(this === window); // => true

  this.innerHTML = 'Clicked button';

});